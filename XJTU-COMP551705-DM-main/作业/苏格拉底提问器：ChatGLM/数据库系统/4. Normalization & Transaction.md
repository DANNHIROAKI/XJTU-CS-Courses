# $\textbf{Normalization \& Transaction}$ 

# $\textbf{1. Normalization}$

> ## $\textbf{1.1. Normalization}$â€‹å®šä¹‰
>
> > **1ï¸âƒ£**å®šä¹‰
> >
> > |                          |                  æ“ä½œ                  |                       ç›®çš„                        |
> > | :----------------------: | :------------------------------------: | :-----------------------------------------------: |
> > |  $\text{Normalization}$  | ä¸€å¤§è¡¨æ ¼$\xrightarrow{æ‹†åˆ†}$è‹¥å¹²å°è¡¨æ ¼ | å»é™¤$\text{Redundancies}$ä»è€Œé¿å…$\text{Anomoly}$ |
> > | $\text{Denormalization}$ | ä¸€å¤§è¡¨æ ¼$\xleftarrow{æ‹¼æ¥}$è‹¥å¹²å°è¡¨æ ¼  |              é¿å…é¢‘ç¹çš„$\text{Join}$              |
> >
> > âš ï¸$\text{Fully Normalized = Eliminate All Anomalies}$ï¼Œä¸€èˆ¬åˆ°$\text{4NF}$æ‰ç®—å®Œå…¨å½’ä¸€åŒ–
> >
> > **2ï¸âƒ£**ç¤ºä¾‹
> >
> > 1. æ ‡å‡†åŒ–å‰
> >
> >    | $\textbf{StuID}$ | $\textbf{SName}$ | $\textbf{CID}$ | $\textbf{CName}$ |
> >    | :--------------: | :--------------: | :------------: | :--------------: |
> >    |    $\text{1}$    |  $\text{John}$   |  $\text{101}$  |  $\text{Math}$   |
> >    |    $\text{2}$    |  $\text{Mary}$   |  $\text{102}$  | $\text{English}$ |
> >    |    $\text{1}$    |  $\text{John}$   |  $\text{103}$  | $\text{Physics}$ |
> >    |    $\text{3}$    |  $\text{Peter}$  |  $\text{101}$  |  $\text{Math}$   |
> >    |    $\text{2}$    |  $\text{Mary}$   |  $\text{103}$  | $\text{Physics}$ |
> >
> > 2. æ ‡å‡†åŒ–å
> >
> >    | $\small\textbf{å­¦ç”Ÿè¡¨}$ | $\small\textbf{StuID}$ | $\small\textbf{SName}$ | $\small\textbf{è¯¾ç¨‹è¡¨}$ | $\small\textbf{CID}$ | $\small\textbf{CName}$ | $\small\textbf{å­¦ç”Ÿ-è¯¾ç¨‹è¡¨}$ | $\small\textbf{StuID}$ | $\small\textbf{CID}$ |
> >    | :---------------------: | :--------------------: | :--------------------: | :---------------------: | :------------------: | :--------------------: | :--------------------------: | :--------------------: | :------------------: |
> >    |       $\text{\\}$       |       $\text{1}$       |  $\small\text{John}$   |       $\text{\\}$       |     $\text{101}$     |  $\small\text{Math}$   |         $\text{\\}$          |       $\text{1}$       |     $\text{101}$     |
> >    |       $\text{\\}$       |       $\text{2}$       |  $\small\text{Mary}$   |       $\text{\\}$       |     $\text{102}$     | $\small\text{English}$ |         $\text{\\}$          |       $\text{2}$       |     $\text{102}$     |
> >    |       $\text{\\}$       |       $\text{1}$       |  $\small\text{John}$   |       $\text{\\}$       |     $\text{103}$     | $\small\text{Physics}$ |         $\text{\\}$          |       $\text{1}$       |     $\text{103}$     |
> >    |       $\text{\\}$       |       $\text{3}$       |  $\small\text{Peter}$  |       $\text{\\}$       |     $\text{101}$     |  $\small\text{Math}$   |         $\text{\\}$          |       $\text{3}$       |     $\text{101}$     |
> >    |       $\text{\\}$       |       $\text{2}$       |  $\small\text{Mary}$   |       $\text{\\}$       |     $\text{103}$     | $\small\text{Physics}$ |         $\text{\\}$          |       $\text{2}$       |     $\text{103}$     |
> >
> > **3ï¸âƒ£**$\text{Normalization/Denormalization}$å¯¹æ¯”
> >
> > |      æ“ä½œ      | $\textbf{Normalization}$ï¼Œæ¯”å¦‚$\textbf{A, B}$ | $\textbf{Denormalization}$ï¼Œæ¯”å¦‚$\textbf{A}\bowtie{}\textbf{B}$ |
> > | :------------: | :-------------------------------------------: | :----------------------------------------------------------: |
> > |   æŸ¥è¯¢ä¸€ä¸ªè¡¨   |                      å¿«                       |                              æ…¢                              |
> > |   æŸ¥è¯¢ä¸¤ä¸ªè¡¨   |                      æ…¢                       |                              å¿«                              |
> > | æ’å…¥/ä¿®æ”¹/åˆ é™¤ |                     å®¹æ˜“                      |                             å›°éš¾                             |
>
> ## $\textbf{1.2. Database Anomalies}$â€‹å¼‚å¸¸
>
> > **1ï¸âƒ£**æ¦‚è¿°ï¼šæœŸæœ«ä¼šç»™ä½ è¡¨æ ¼ï¼Œè®©ä½ ç”¨æ–‡å­—æè¿°ä¸¾ä¾‹ä¸‰ç§$\text{Anomaly}$â€‹ 
> >
> > 1. ç¤ºä¾‹è¡¨æ ¼
> >
> >    | $\textbf{Order(PFK)}$ | $\textbf{Item(PFK)}$ | $\textbf{Desc}$ | $\textbf{Qty}$ |
> >    | :------------------: | :------------------: | :-------------: | :------------: |
> >    |     $\text{27}$      |     $\text{873}$     |  $\text{nut}$   |   $\text{2}$   |
> >    |     $\text{28}$      |     $\text{873}$     |  $\text{nut}$   |  $\text{10}$   |
> >    |     $\text{30}$      |     $\text{495}$     | $\text{washer}$ |  $\text{50}$   |
> >
> > 2. åŸºæœ¬æ¦‚å¿µ
> >
> >    | $\textbf{Anomaly}$ |              å«ä¹‰              | ç¤ºä¾‹(ä¸‹è¡¨)                                                   |
> >    | :----------------: | :----------------------------: | :----------------------------------------------------------- |
> >    | $\text{Insertion}$ | æ’å…¥æ•°æ®$\text{â†’}$æ’å…¥å…¶ä»–æ•°æ® | æ’å…¥$\text{Item/Desc}\xrightarrow{è¿˜éœ€}$æ’å…¥$\text{Order/Qty}$ |
> >    | $\text{Deletion}$  | åˆ é™¤æ•°æ®$\text{â†’}$åˆ é™¤å…¶ä»–æ•°æ® | åˆ é™¤$\text{Order30}\xrightarrow{å¼•èµ·}$æ•´è¡Œåˆ é™¤               |
> >    |  $\text{Update}$   | æ›´æ–°æ•°æ®$\text{â†’}$æ›´æ–°å…¶ä»–æ•°æ® | æ›´æ–°$\text{Item873}$çš„$\text{Desc}\xrightarrow[æœ‰ä¸¤å¤„\text{Item873}]{å¼•èµ·}$ä¸¤å¤„$\text{Desc}$æ›´æ–° |
> >
> > **2ï¸âƒ£**ç”¨$\text{NULL}$æ¥è§£å†³$\text{Anomaly:}$ ä¸èƒ½æ ¹æœ¬è§£å†³
> >
> > 1. $\text{Insertion Anomaly}$å¯èƒ½å¯ä»¥ï¼ŒåŸå› åœ¨äº$\text{PK}$æ˜¯ä¸èƒ½$\text{NULL}$çš„
> >    - å¯ä»¥çš„ç¤ºä¾‹ï¼šæ’å…¥$\text{Order/Item/Desc}\to{}\text{Qty}$ä¸º$\text{NULL}$ 
> >    - ä¸å¯ä»¥çš„ç¤ºä¾‹ï¼šæ’å…¥$\text{Item/Desc}\to{}\text{Qty}$ä¸º$\text{NULL/}\text{Order}$ä¸èƒ½ä¸º$\text{NULL}$â€‹ 
> > 2. $\text{Deletion Anomaly:}$  åŒç†å¯èƒ½å¯ä»¥ï¼Œå½“åˆ é™¤çš„æ•°æ®ä¸æ˜¯$\text{PK}$æ—¶ï¼Œå¯è€ƒè™‘è®¾ä¸º$\text{NULL}$ 
> > 3. $\text{Update Anomaly:}$ ç»å¯¹æ²¡æˆï¼Œä¸å¯èƒ½æ›´æ–°æˆ$\text{NULL}$ 
>
> ## $\textbf{1.3. Functional Dependencies}$â€‹ 
>
> > **1ï¸âƒ£**æ¦‚è¿°
> >
> > 1. å®šä¹‰ï¼š$\text{A set of attributes X determines another set of attributes Y uniquely}$ 
> > 2. ç¬¦å·ï¼š$\text{X}\to{}\text{Y}$è¡¨ç¤ºå¦‚æœçŸ¥é“$\text{X}$å°±çŸ¥é“$\text{Y}$ï¼Œæ¯”å¦‚$\text{Stu-Name}\to{}\text{Stu-FirstName}$â€‹  
> > 3. æ€§è´¨ï¼š
> >    - ä¾èµ–æ’ç­‰å¼ï¼š$\text{X}\to{}\text{X}$ ï¼Œ$\text{PK}\to{}\text{All Column}$â€‹ 
> >    - æ‹†åˆ†åŸåˆ™$\text{: AB}\to{}\text{CD}\begin{cases}å¯ä»¥æ‹†åˆ†ä¸º\text{: AB}\to{}\text{C / }\text{AB}\to{}\text{D}\\\\ä¸å¯æ‹†åˆ†ä¸º\text{: A}\to{}\text{CD / }\text{B}\to{}\text{CD}\end{cases}\to{}åªæœ‰å³ä¾§å¯æ‹†åˆ†$â€‹ 
> >
> > **2ï¸âƒ£**æœ‰å…³æ¦‚å¿µï¼šä»¥$\text{A}(\underline{\text{X}}, \underline{\text{Y}}, \text{Z}, \text{D})$ä¸ºä¾‹
> >
> > 1. $\text{Determinants:}$ 
> >
> >    - ç®­å¤´å·¦ä¾§çš„å±æ€§ï¼Œæ¯”å¦‚$\underline{\text{X}} ,\underline{\text{Y}}\to{}\text{Z}$ä¸­çš„$\text{XY}$
> >    - è‡³äºè¿™å…¶ä¸­$\text{Z}$å«ä»€ä¹ˆå°±æ— å…·ä½“è¯´æ³•
> >
> > 2. $\text{Key/Non-Key}$å±æ€§ï¼šåŒ…å«/ä¸åŒ…å«$\text{PK}$çš„å±æ€§ï¼Œæ¯”å¦‚
> >
> >    |       å±æ€§ç±»å‹       |                        å«ä¹‰                        |                     ç¤ºä¾‹                     |
> >    | :------------------: | :------------------------------------------------: | :------------------------------------------: |
> >    |   $\text{Key}$å±æ€§   | åŒ…å«$\text{PK}$çš„å±æ€§ï¼Œæˆ–è€…è¯´æ˜¯$\text{PK}$çš„ä¸€éƒ¨åˆ† | $\underline{\text{X}} ,\underline{\text{Y}}$ |
> >    | $\text{Non-Key}$å±æ€§ |                      å…¶ä½™å±æ€§                      |             $\text{Z} ,\text{D}$             |
> >
> > 3. ä¸¤ç§$\text{Dependency}$â€‹â€‹  
> >
> >    |                ä¾èµ–ç±»å‹                |                             å«ä¹‰                             |                 ç¤ºä¾‹                 |
> >    | :------------------------------------: | :----------------------------------------------------------: | :----------------------------------: |
> >    | $\text{Partial Functional Dependency}$ | $\text{Key}$å±æ€§($\text{PK}$çš„ä¸€éƒ¨åˆ†)$\xrightarrow{å†³å®š}\text{Non-Key}$å±æ€§ | $\underline{\text{Y}} \to{}\text{Z}$ |
> >    | $\text{Transitive Dependency}$(ä¼ é€’æ€§) |  $\text{Non-Key}$å±æ€§$\xrightarrow{å†³å®š}\text{Non-Key}$å±æ€§  |       $\text{Z} \to{}\text{D}$       |
> >
> > **3ï¸âƒ£**$\text{Armstrongâ€™s Axioms}$(å…¬ç†)
> >
> > |      $\textbf{Axioms}$      |                             æ¡ä»¶                             | $\Rightarrow$ |               ç»“æœ                |                 å¤‡æ³¨                  |
> > | :-------------------------: | :----------------------------------------------------------: | :-----------: | :-------------------------------: | :-----------------------------------: |
> > |    $\text{Reflexivity}$     |                 $\text{B}\subseteq\text{A}$                  | $\Rightarrow$ |  $\text{A} \rightarrow \text{B}$  | æˆ–è€…è¯´$\text{A}\text{B}\to{}\text{A}$ |
> > | $\text{Augmentation}$(æ‰©å±•) |                $\text{A}\rightarrow\text{B}$                 | $\Rightarrow$ | $\text{AC} \rightarrow \text{BC}$ |             $\text{N/A}$              |
> > |     $\text{Transitive}$     | $\text{A} \rightarrow \text{B }\land{}\text{ B}\rightarrow \text{C}$ | $\Rightarrow$ |  $\text{A} \rightarrow \text{C}$  |             $\text{N/A}$              |
>
> ## $\textbf{1.4. Normal Form}$â€‹ 
>
> > **0ï¸âƒ£**$\text{Overview}$ 
> >
> > | $\textbf{Normal Form}$ | $\textbf{Description}$                                       |
> > | :--------------------: | ------------------------------------------------------------ |
> > |      $\text{0NF}$      | æ··æ²Œä¹‹ç‰©$\text{ (Non-Relational)}$                           |
> > |      $\text{1NF}$      | æ— $\text{Repeating Groups}$                                  |
> > |      $\text{2NF}$      | æ— $\text{Repeating Groups+}\text{Partial Dependency}$        |
> > |      $\text{3NF}$      | æ— $\text{Repeating Groups+}\text{Partial Dependency+}\text{Transitive Dependency}$ |
> >
> > **1ï¸âƒ£**$\text{1NF}$â€‹ 
> >
> > 1. $\text{1NF}$ çš„åŸºæœ¬ç‰¹å¾ï¼Œ==$\text{(}$ä¸æ»¡è¶³ä»¥ä¸‹ç‰¹å¾çš„å°±æ˜¯$\text{Non-Relational Model)}$== 
> >    - ä¸èƒ½æœ‰é‡å¤çš„åˆ—
> >    
> >    - ä¸èƒ½æœ‰$\text{Repeating Groups}$ï¼Œå³è¡¨ä¸­ä¸€ä¸ªå•å…ƒ($\text{Fill}$)åªèƒ½æœ‰ä¸€ä¸ªæ•°æ®
> >    
> >      (ä¸åŒå•å…ƒçš„æ•°æ®ç”¨é€—å·éš”å¼€ï¼Œä½†æ³¨æ„æœ‰äº›æ•°æ®å•å…ƒå†…æœ¬å°±æœ‰é€—å·å¦‚$\text{Address}$)
> >    
> > 2. $\text{Non-Relational Modelâ†’1NF:}$
> >
> >    - å°†$\text{Repeating Groups}$ä»åŸè¡¨ä¸­æ‹†åˆ†æˆæ–°è¡¨
> >    - å°†åŸè¡¨çš„$\text{PK}\begin{cases}ä¸€ä»½ä¿ç•™åœ¨åŸå…³ç³»\to{}ä½œ\text{PK}\\\\ä¸€ä»½å¤åˆ¶åˆ°æ–°å…³ç³»\to{}ä½œ\text{PFK}\end{cases}$ 
> >
> > 3. ç¤ºä¾‹ï¼šæ³¨æ„åŒºåˆ†$\underline{\text{PK}}$ï¼Œ$\overline{{\text{FK}}}$ï¼Œ$\overline{\underline{\text{PFK}}}$çš„è¡¨ç¤ºæ–¹æ³•
> >
> >    $\text{Order-Item(}\underline{\color{red}{\text{Order}}}\text{, Cust, (}\underline{\color{green}{\text{Item}}}\text{, Desc, Qty))}\text{â†’}\begin{cases}
> >    \text{Order(}{\underline{\color{red}{\text{Order}}}}\text{, Cust)} \\\\
> >    \text{Order-Item(}\overline{\underline{\color{red}{\text{Order}}}}\text{, }\underline{\color{green}{\text{Item}}}\text{, Desc, Qty)}
> >    \end{cases}$ 
> >
> > **2ï¸âƒ£**$\text{2NF}$ 
> >
> > 1. $\text{2NF}$åŸºæœ¬ç‰¹å¾ï¼š$\text{Part of Composite Key}\xrightarrow[âŒ]{\text{Identify}}\text{Non-key Attribut (NO Partial ä¾èµ–)}$  
> > 2. $\text{1NFâ†’2NF:}$ ç§»é™¤$\text{Partial Dependencies}$â€‹â€‹ 
> >
> >    - æŠŠ$\text{Partial Dependencies}$ä»åŸå…³ç³»ä¸­å‰¥ç¦»å‡ºæ¥
> >    - $\text{Partial Dependencies}$çš„$\text{Determinant}\begin{cases}ä¸€ä»½ä¿ç•™åœ¨åŸå…³ç³»\to{}ä½œ\text{PFK}\\\\ä¸€ä»½å‰¥ç¦»åˆ°æ–°å…³ç³»\to{}ä½œ\text{PK}\end{cases}$ 
> > 3. ç¤ºä¾‹ï¼šæ³¨æ„åŒºåˆ†$\underline{\text{PK}}$ï¼Œ$\overline{{\text{FK}}}$ï¼Œ$\overline{\underline{\text{PFK}}}$çš„è¡¨ç¤ºæ–¹æ³•
> >
> >    - $å‡è®¾\text{Order-Item(}\overline{\underline{\text{Order}}}\text{, }\underline{\text{Item}}\text{, Desc, Qty))å­˜åœ¨}\begin{cases}\overline{\underline{\text{Order}}},\underline{\text{Item}}\to{}\text{Qty}\\\\\underline{\text{Item}}\to{}\text{Desc (Partial Dependency)}\end{cases}$ 
> >    - $\text{Order-Item}\text{â†’}
> >      \begin{cases}
> >          \text{Order(}\underline{\color{red}{\text{Order}}}\text{, Cust)} \\\\
> >          \text{Order-Item(}\overline{\underline{\color{red}{\text{Order}}}}\text{, }\underline{\color{green}{\text{Item}}}\text{, Desc, Qty))â†’}
> >          \begin{cases}
> >              \text{Item(}\underline{\color{green}{\text{Item}}}\text{, Desc)} \\\\
> >              \text{Order-Item(}\overline{\underline{\color{red}{\text{Order}}}}\text{, }\overline{\underline{\color{green}{\text{Item}}}}\text{, Qty)}
> >          \end{cases}
> >      \end{cases}$    
> >
> > **3ï¸âƒ£**$\text{3NF}$â€‹â€‹ 
> >
> > 1. $\text{3NF}$åŸºæœ¬ç‰¹å¾ï¼š$\text{Non-key Attribut}\xrightarrow[âŒ]{\text{Identify}}\text{Non-key Attribut (NO Transitive ä¾èµ–)}$   
> > 2. $\text{2NFâ†’3NF:}$ ç§»é™¤$\text{Transitive Dependencies}$â€‹â€‹ 
> >    - æŠŠ$\text{Transitive Dependency}$ä»åŸå…³ç³»å‰¥ç¦»å‡ºæ¥
> >    - $\text{Transitive Dependency}$çš„$\text{Determinant}\begin{cases}ä¸€ä»½ä¿ç•™åœ¨åŸå…³ç³»\to{}ä½œ\text{FK}\\\\ä¸€ä»½å‰¥ç¦»åˆ°æ–°å…³ç³»\to{}ä½œ\text{PK}\end{cases}$ 
> > 3. ç¤ºä¾‹ï¼šæ³¨æ„åŒºåˆ†$\underline{\text{PK}}$ï¼Œ$\overline{{\text{FK}}}$ï¼Œ$\overline{\underline{\text{PFK}}}$çš„è¡¨ç¤ºæ–¹æ³•
> >    - å‡è®¾$\begin{cases}\underline{\text{Empt}}\to{}\text{Ename, Dept}\\\\{\text{Dept}}\to{}\text{Dname (Transitive Dependency)}\end{cases}$
> >    - $\text{Emp(}\underline{\color{red}{\text{Emp}}}\text{, Ename, Dept, Dname)}\to{}
> >      \begin{cases}
> >          \text{Emp(}\underline{\color{red}{\text{Emp}}}\text{, Ename, }\overline{\color{green}{\text{Dept}})} \\\\
> >          \text{Dept(}\underline{\color{green}{\text{Dept}}}\text{, Dname)}
> >      \end{cases}$   
> >
> > **4ï¸âƒ£**å…¶ä»–çº§åˆ«çš„$\text{NF}$==(è¯¾å¤–ï¼Œå¯ä¸çœ‹)== 
> >
> > 1. $\text{BCNF:}$ $\text{Non-key Attribut}\xrightarrow[âŒ]{\text{Identify}}\text{Part of Composite Key}$â€‹  
> >
> > 2. $\text{4NF:}$è§£å†³$\text{Multivalue Dependency}$
> >
> >    - å¤šå€¼ä¾èµ–ï¼šæ¯”å¦‚è‹¥ä¸‹åˆ—$\begin{cases}\text{M}\xrightarrow{âœ”ï¸}\text{S}\\\text{M}\xrightarrow{âœ”ï¸}\text{C}\\\text{C}\xleftrightarrow{âŒ}\text{S}\end{cases}\to$åˆ™å­˜åœ¨å¤šå€¼ä¾èµ–ï¼Œä¸”è®°ä¸º$\begin{cases}\text{Mâ†’â†’S}\\\\\text{Mâ†’â†’C}\end{cases}$ 
> >
> >      | $\textbf{M}$ | $\textbf{S}$ | $\textbf{C}$ |
> >      | :----------: | :----------: | :----------: |
> >      | $\text{M1}$  | $\text{S1}$  | $\text{C1}$  |
> >      | $\text{M1}$  | $\text{S1}$  | $\text{C2}$  |
> >      | $\text{M1}$  | $\text{S2}$  | $\text{C1}$  |
> >
> >    - å½“å…³ç³»è¾¾åˆ°$\text{4NF}$æ—¶å°±è®¤ä¸ºå®Œæˆ$\text{Normalization}$äº†ï¼Œå·²ç»æ²¡æœ‰$\text{Duplicates}$â€‹â€‹äº†
> >
> > 3. $\text{5NF:}$è§£å†³$\text{Loss Dependency}$
> >
> >    - è‹¥è¡¨æ ¼æ‹†å¼€åˆæ‹¼å›å»ä¸æ”¹å˜åŸè¡¨æ ¼($\text{Lossless-Join}$åˆ†è§£)ï¼Œåˆ™è¡¨æ ¼å°±æœ‰$\text{Loss Dependency}$
> >    - ä½†å®é™…ä¸Šä¸ä¼šå¦‚æ­¤å¹æ¯›æ±‚ç–µäº†
> >

# $\textbf{2. Transaction}$â€‹(äº‹åŠ¡)

> ## $\textbf{2.1. }$æ¦‚å¿µä¸æ¦‚è¿°
>
> > **1ï¸âƒ£**$\text{Tansaction}$å®šä¹‰ï¼š
> >
> > 1. å®šä¹‰ï¼šæ•°æ®åº“æ“ä½œåºåˆ—($\text{A logical unit of work}$â€‹)
> >
> > 2. æ ¹æœ¬ç‰¹æ€§ï¼šè¦ä¹ˆä¸€æ¬¡æ€§æ‰§è¡Œå®Œ$\text{Entirely Completed}$è¦ä¹ˆ$\text{Aborted}$â€‹â€‹â€‹ï¼Œæ˜¯ä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ 
> >
> >    |        çŠ¶æ€        | æ“ä½œ                                                   |
> >    | :----------------: | :----------------------------------------------------- |
> >    |  $\text{COMMIT}$   | äº‹åŠ¡æ­£å¸¸ç»“æŸï¼Œå®Œæˆæ‰€æœ‰æ“ä½œ(è¯»å–æ•°æ®ï¼Œæ›´æ–°å†™å›ç¡¬ç›˜)     |
> >    | $\text{ROLL BACK}$ | äº‹åŠ¡å¼‚å¸¸ç»“æŸï¼Œä¸­é€”ä¸å†ç»§ç»­è¿è¡Œï¼Œå·²å®Œæˆçš„æ“ä½œä¹Ÿå…¨éƒ¨æ’¤å› |
> >
> > **2ï¸âƒ£**$\text{Tansaction}$å¼•å…¥çš„ç›®çš„
> >
> > 1. å®šä¹‰$\text{Unit of Work}$ï¼Œé€‚ç”¨äºä¸€ä¸ª/å¤šä¸ªç”¨æˆ·
> > 2. $\text{Concurrent Access}$ï¼Œå…è®¸å¤šä¸ª$\text{Command}$äº¤ç»‡æ‰§è¡Œï¼Œé€‚ç”¨äºå¤šä¸ªç”¨æˆ·
> >
> > **3ï¸âƒ£**$\text{Tansaction}$ç§ç±»
> >
> > 1. $\text{Implicit Transaction:}$ å•ç‹¬ä¸€å¥$\text{DML/DDL}$å°±æ˜¯$\text{Transaction}$â€‹ 
> >
> >    ```sql
> >    SELECT / INSERT / DELETE / CREATE / ALTER / DROP -- æ¯”å¦‚ä¸€ä¸ªSELECTå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡
> >    ```
> >
> > 2. $\text{User-Defined Transaction:}$ éœ€è¦å…³é”®å­—`BEGIN/COMMIMT/RILLBACK` 
> >
> >    ```sql
> >     -- ä»SATRTåˆ°COMMITä¸è®ºä¸­é—´å¤šå°‘è¯­å¥ï¼Œéƒ½åªç®—ä¸€ä¸ªTransaction
> >    START TRANSACTION; -- å¼€å§‹äº‹åŠ¡,ä¹Ÿå¯ä»¥ç”¨BEGIN TRANSACTION
> >     -- SQL è¯­å¥1
> >     -- SQL è¯­å¥2
> >    COMMIT; -- æäº¤äº‹åŠ¡
> >    ROLLBACK; -- æˆ–è€…å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œå›æ»šäº‹åŠ¡
> >    ```
> >
> > **4ï¸âƒ£**$\text{Transaction}$æ€§è´¨$\text{: ACID}$â€‹ 
> >
> > |         æ€§è´¨         | æè¿°                                                         |
> > | :------------------: | :----------------------------------------------------------- |
> > |  $\text{Atomicity}$  | $\text{Transaction}$æ˜¯ä¸å¯åˆ†å‰²çš„é€»è¾‘å·¥ä½œå•ä½(æ‰§è¡Œå®Œ$\text{Or}$å›é€€) |
> > | $\text{Consistancy}$ | $\text{Transaction}$æ‰§è¡Œå‰åæ•°æ®åº“éƒ½æ˜¯ä¸€è‡´çŠ¶æ€$\text{+}$å¤šç”¨æˆ·è¯»å–æ•°æ®æ—¶åº”çœ‹åˆ°ç›¸åŒå€¼ |
> > |  $\text{Isolation}$  | è¿è¡Œç»“æŸå‰ä¸€ä¸ª$\text{Transaction}$çš„æ”¹å˜å¯¹å…¶ä»–$\text{Transaction}$ä¸å¯è§ |
> > | $\text{Durability}$  | ä¸€æ—¦$\text{Transaction}$æ‰§è¡Œå®Œå…¶å¯¹æ•°æ®çš„æ”¹å˜æ°¸ä¹…æœ‰æ•ˆ(å³ä½¿ç³»ç»Ÿå´©æºƒ) |
> >
>
> ## $\textbf{2.2. Serializability}$ 
>
> > **1ï¸âƒ£**$\text{Transaction}$çš„äº¤å‰æ‰§è¡Œ($\text{Interleaved}$)ï¼šæ³¨æ„$\text{Transaction}\xrightarrow{ç¼©å†™}\text{TXN}$
> >
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240526204243601.png" alt="image-20240526204243601" style="zoom:56%;" /> 
> >
> > |    $\textbf{Execution}$ç§ç±»     |             å«ä¹‰             |           å¤‡æ³¨           |
> > | :-----------------------------: | :--------------------------: | :----------------------: |
> > | $\text{Concurrent/Interleaved}$ | ä¸åŒ$\text{TXN}$äº¤å‰å¹¶è¡Œæ‰§è¡Œ | å®é™…$\text{TXN}$æ‰§è¡Œæ–¹å¼ |
> > |    $\text{Serial Execution}$    |  ä¸åŒ$\text{TXN}$ä¸€ä¸ªä¸ªæ‰§è¡Œ  | æœ€å®‰å…¨ä½†æœ€ä½æ•ˆçš„æ‰§è¡Œæ–¹å¼ |
> >
> > **2ï¸âƒ£**ç¤ºä¾‹
> >
> > 1. $\text{Serial Execution}$â€‹çš„è¯»å†™æ“ä½œ
> >
> >    | $\textbf{TXN}$ | $\textbf{Stage1}$ | $\textbf{Stage2}$ | $\textbf{Stage3}$ | $\textbf{Stage4}$ |
> >    | :------------: | :---------------: | :---------------: | :---------------: | :---------------: |
> >    | $\text{TXN1}$  |   $\text{R(A)}$   |   $\text{W(A)}$   |    $\text{\\}$    |    $\text{\\}$    |
> >    | $\text{TXN2}$  |    $\text{\\}$    |    $\text{\\}$    |   $\text{R(B)}$   |   $\text{W(B)}$   |
> >
> > 2. $\text{Concurrent Execution}$çš„è¯»å†™æ“ä½œï¼š==é»„æ ‡==ä¸º$\text{Concurrent Execution}$éƒ¨åˆ†
> >
> >    | $\textbf{TXN}$ | $\textbf{Stage1}$ | ==$\textbf{Stage2}$== | $\textbf{Stage3}$ | ==$\textbf{Stage4}$== |
> >    | :------------: | :---------------: | :-------------------: | :---------------: | :-------------------: |
> >    | $\text{TXN1}$  |   $\text{R(A)}$   |     $\text{R(A)}$     |   $\text{W(A)}$   |     $\text{W(A)}$     |
> >    | $\text{TXN2}$  |    $\text{\\}$    |     $\text{R(B)}$     |    $\text{\\}$    |     $\text{W(B)}$     |
> >
> >
> > :three:$\text{Serializable}$ 
> >
> > 1. å«ä¹‰ï¼šå¤šä¸ª$\text{TXN}$æ˜¯$\text{Serializable}\xLeftrightarrow{\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }\text{ }}$(å¤šä¸ª$\text{TXN}$å¹¶è¡Œæ‰§è¡Œæ•ˆæœ $ \equiv\text{Serial Execution}$æ‰§è¡Œæ•ˆæœ)
> >
> > 2. ä¸Šä¾‹ä¸­ï¼šè‹¥$\text{AB}$çš„è¯»å†™äº’ä¸å¹²æ‰°ï¼Œåˆ™ä¸¤è¡¨æœ€ç»ˆç»“æœä¸€æ ·ï¼Œåˆ™$\text{TXN1/2}$æ˜¯$\text{Serializable}$ 
>
> ## $\textbf{2.3. Concurrent Execution}$çš„é—®é¢˜ä¸è§£å†³
>
> > ### $\textbf{2.3.1. Concurrent Access Conflict}$ 
> >
> > > ğŸ¤”å‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼šå¤š$\text{TXN}$æ“ä½œåŒä¸€$\text{Object}$ï¼Œå¹¶ä¸”å…¶ä¸­è‡³å°‘ä¸€ä¸ªæ“ä½œæ˜¯$\text{Write}$ 
> > >
> > > **1ï¸âƒ£**$\text{Loss Update Problem:}$ å¤šæ¬¡é’ˆå¯¹ä¸€ä¸ª$\text{Object}$å†™ï¼Œ$\text{Object}$ä¸ºæœ€åä¸€æ¬¡å†™çš„å†…å®¹
> > >
> > > | $\textbf{TXN}$ | $\textbf{Stage1}$ | $\textbf{Stage2}$ | $\textbf{Stage3}$ | $\textbf{Stage4}$ | $\textbf{Stage5}$ |
> > > | :------------: | :---------------: | :---------------: | :---------------: | :---------------: | :---------------: |
> > > |  $\text{Bob}$  |   $\text{R(A)}$   |    $\text{\\}$    |   $\text{W(A)}$   |    $\text{\\}$    |  $\text{COMMIT}$  |
> > > | $\text{Alice}$ |    $\text{\\}$    |   $\text{R(A)}$   |    $\text{\\}$    |   $\text{W(A)}$   |  $\text{COMMIT}$  |
> > >
> > > - æœ€åç»“æœæ˜¯$\text{Alice}$â€‹å†™å…¥å†…å®¹
> > >
> > > **2ï¸âƒ£**$\text{Uncommitted Data/Dirty Read Problem:}$ æŸ$\text{TXN}$å›é€€å¯¼è‡´æœªäº¤ä»˜æ•°æ®è¢«åé¢$\text{TXN}$ä½¿ç”¨
> > >
> > > | $\textbf{TXN}$ | $\textbf{Stage1}$ | $\textbf{Stage2}$ | $\textbf{Stage3}$ | $\textbf{Stage4}$ | $\textbf{Stage5}$  |
> > > | :------------: | :---------------: | :---------------: | :---------------: | :---------------: | :----------------: |
> > > |  $\text{Bob}$  |   $\text{R(A)}$   |   $\text{W(A)}$   |    $\text{\\}$    |    $\text{\\}$    | $\text{ROLL BACK}$ |
> > > | $\text{Alice}$ |    $\text{\\}$    |    $\text{\\}$    |   $\text{R(A)}$   |   $\text{W(A)}$   |  $\text{COMMIT}$   |
> > >
> > > - $\text{W(A)}$æ•°æ®å¹¶æœª$\text{COMMIT}$ä½†å´è¢«$\text{Alice}$â€‹ä½¿ç”¨
> > >
> > > **3ï¸âƒ£**$\text{Inconsistent Retrieval Problem:}$ ä¸€ä¸ª$\text{TXN}$åœ¨èšåˆå‡½æ•°æ“ä½œ$\text{+}$å¦ä¸€ä¸ª$\text{TXN}$åœ¨$\text{Update}$â€‹æ•°æ®
> > >
> > > <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240526220018050.png" alt="image-20240526220018050" style="zoom: 50%;" />  
> > >
> > > - ç†è®ºä¸Šï¼Œå¯ä»¥åˆç†å®‰æ’$\text{Interleaved}$â€‹æ¥é¿å…å†²çª
> >
> > ### $\textbf{2.3.2. Concurrency Control Method:}$ è§£å†³å†²çª
> >
> > > #### $\textbf{2.3.2.0. }$æ¦‚è¿°
> > >
> > > > **1ï¸âƒ£**æ€»ä½“æ€è·¯ï¼šåˆç†å®‰æ’è¯»å†™æ“ä½œçš„é¡ºåº
> > > >
> > > > **2ï¸âƒ£**åŸºæœ¬æ€è·¯
> > > >
> > > > |      åŸºæœ¬æ€è·¯       | æ“ä½œ                                    |       å¤‡æ³¨        |
> > > > | :-----------------: | :-------------------------------------- | :---------------: |
> > > > | $\text{Pesimistic}$ | å…ˆæ£€æŸ¥æœ‰æ— é—®é¢˜ï¼Œä»¥é€‰æ‹©ä¸æ‰§è¡Œ/æ›´æ­£åæ‰§è¡Œ | æ¯”å¦‚$\text{Lock}$ |
> > > > | $\text{Optimistic}$ | å…ˆä¸€è‚¡è„‘æ‰§è¡Œï¼Œæ‰§è¡Œå®Œåæœ‰é—®é¢˜å†å›æ¥æ›´æ­£  |   æ­¤è¯¾ç¨‹ä¸æ¶‰åŠ    |
> > > >
> > > > - $\text{Optimistic}$æ–¹æ³•ï¼š$\text{Timestamping}$å’Œ$\text{Optimistic Concurrency Control}$ 
> > >
> > > #### $\textbf{2.3.2.1.  Lock Method}$ 
> > >
> > > > **1ï¸âƒ£**æ€»ä½“æ€è·¯ï¼š
> > > >
> > > > 1. é€»è¾‘ä¸Šï¼šé€šè¿‡è®©$\text{TXN}$æŒæœ‰$\text{Lock}$ï¼Œè®©å½“å‰$\text{TXN}$éœ¸å æŸä¸ªæ•°æ®é¡¹($\text{Exclusive Use of Data}$) 
> > > > 2. ç‰©ç†ä¸Šï¼šåœ¨$\text{RAM}$ä¸Šè®¾ç½®$\text{Lock Manager}$æ¥ç®¡ç†$\text{Lock}$çš„æ•°æ®
> > > >
> > > > **2ï¸âƒ£**$\text{Level/Gradularity}$(ç²¾ç»†åº¦)$\text{of Lock}$ 
> > > >
> > > > |                   $\textbf{Gradularity}$                    |             å«ä¹‰             |                          ä½¿ç”¨é¢‘ç‡                          |
> > > > | :---------------------------------------------------------: | :--------------------------: | :--------------------------------------------------------: |
> > > > | <span style="color:#99FF00;">$\text{Database-Level}$</span> |        é”ä½æ•´ä¸ªæ•°æ®åº“        | <span style="color:#99FF00;">$\text{Slightly Rare}$</span> |
> > > > |  <span style="color:#FF9900;">$\text{Table-Level}$</span>   |         é”ä½ä¸€å¼ è¡¨æ ¼         |  <span style="color:#FF9900;">$\text{Very Common}$</span>  |
> > > > |   <span style="color:#FFCC00;">$\text{Page-Level}$</span>   | é”ä½ä¸€é¡µ(ä¸€å¼ è¡¨å­˜å‚¨åœ¨å¤šé¡µä¸­) |    <span style="color:#FFCC00;">$\text{Common}$</span>     |
> > > > |   <span style="color:#FF3300;">$\text{Row-Level}$</span>    |        é”ä½è¡¨ä¸­çš„ä¸€è¡Œ        |  <span style="color:#FF3300;">$\text{Most Common}$</span>  |
> > > > |  <span style="color:#00FF00;">$\text{Field-Level}$</span>   |       é”ä½è¡¨ä¸­çš„æŸä¸ªå€¼       |     <span style="color:#00FF00;">$\text{Rare}$</span>      |
> > > >
> > > > 1. ç†æƒ³æƒ…å†µ$\text{Field-Level}$æœ€å¥½ï¼Œä½†å…¶$\text{Lock}$â€‹è¿‡äºå¤æ‚($\text{High Overhead}$)ï¼Œåå€’æœ€ä¸å¸¸ç”¨
> > > > 2. åœ¨$\text{MySQL}$ä¸­ï¼Œå¦‚æœå¤šå±‚çº§$\text{Lock}$è¢«åº”ç”¨ï¼Œåˆ™éœ€è¦$\text{Intention Lock}$â€‹â€‹æ¥è¾…åŠ©
> > > >
> > > > **3ï¸âƒ£**$\text{Types of Lock}$â€‹â€‹ 
> > > >
> > > > 1. $\text{Binary Lock:}$ ä»…$\text{Lock/Unlock}$ä¸¤ç§çŠ¶æ€ï¼Œåªè¦ç”¨åˆ°æ•°æ®(ä¸è®ºè¯»å†™)éƒ½æ˜¯$\text{Lock}$ 
> > > >
> > > > 2. $\text{Shared and Exclusive Locks(Read and Write Locks)}$
> > > >
> > > >    - æè¿°
> > > >
> > > >      |        $\textbf{Type}$        |                é€‚ç”¨æƒ…å†µ                 |         è¦æ±‚          |
> > > >      | :---------------------------: | :-------------------------------------: | :-------------------: |
> > > >      |   $\text{Share/Read Lock}$    |        $\text{Read Table Only}$         | æ— $\text{Write Lock}$ |
> > > >      | $\text{Exclusive/Write Lock}$ | $\text{Update(Write) Records in Table}$ |  æ— å…¶ä»–$\text{Lock}$  |
> > > >
> > > >    - è¦æ±‚è¡¨ï¼Œ==è¿™å¼ è¡¨å¾ˆé‡è¦== 
> > > >
> > > >      |          æ“ä½œ           | å·²æœ‰$\textbf{S-Lock}$ | å·²æœ‰$\textbf{X-Lock}$ |
> > > >      | :---------------------: | :-------------------: | :-------------------: |
> > > >      | ç”³è¯·æ–°çš„$\text{S-Lock}$ |           âœ”ï¸           |           âŒ           |
> > > >      | ç”³è¯·æ–°çš„$\text{X-Lock}$ |           âŒ           |           âŒ           |
> > > >
> > > > **4ï¸âƒ£**ä¸Šé”ä¸è§£é”$\text{Two Phase Policy}$ 
> > > >
> > > > 1. $\text{Two Phase Policy:}$â€‹â€‹ 
> > > >
> > > >    |   $\textbf{Phase}$    | æè¿°                                                    |
> > > >    | :-------------------: | ------------------------------------------------------- |
> > > >    |  $\text{Grow Phase}$  | ç»™$\text{Object}$ä¸€ä¸ªä¸ªä¸Šé”                             |
> > > >    | $\text{Shrink Phase}$ | ç»™$\text{Object}$ä¸€ä¸ªä¸ªè§£é”ï¼Œå½“è§£é”å¼€å§‹æ—¶å°±ä¸èƒ½å†ä¸Šé”äº† |
> > > >
> > > > 2. $\text{Strict Two Phase Policy:}$â€‹ ç›¸æ¯”äºé$\text{Strict}$æœ‰å¦‚ä¸‹æ”¹å˜
> > > >
> > > >    - åªæœ‰åœ¨$\text{Transaction COMMIT}$åæ‰èƒ½è§£é”
> > > >    - è§£é”ä¸æ˜¯ä¸€ä¸ªä¸ªè§£é”ï¼Œè€Œæ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨è§£é”
> > >
> > > #### $\textbf{2.3.2.2. Unresolvable Problem For Lock: Deadlock}$â€‹ 
> > >
> > > > **1ï¸âƒ£**åŸºæœ¬æ€è·¯
> > > >
> > > > |      åŸºæœ¬æ€è·¯       | æ“ä½œ                                              |     å¤‡æ³¨     |
> > > > | :-----------------: | ------------------------------------------------- | :----------: |
> > > > | $\text{Pesimistic}$ | æ‰§è¡Œå‰å…ˆæ£€æŸ¥æ˜¯å¦æ­»é”ï¼Œå¦‚æœæ­»é”å°±ä¸æ‰§è¡Œ/æ›´æ­£åæ‰§è¡Œ | $\text{N/A}$ |
> > > > | $\text{Optimistic}$ | å…ˆä¸€è‚¡è„‘æ‰§è¡Œï¼Œæ¯éš”ä¸€æ®µæ—¶é—´æ£€æµ‹æ˜¯å¦é”æ­»å¹¶åŠ ä»¥è§£å†³  |  æ­¤å¤„ä¸æ¶‰åŠ  |
> > > >
> > > > **2ï¸âƒ£**æ­»é”$\text{Detection}$çš„æ–¹æ³•ï¼š$\text{Wait-For Graph}$ 
> > > >
> > > > 1. ç”¨åœˆä»£è¡¨$\text{TXN}$ï¼Œç”¨ç®­å¤´è¡¨ç¤ºç­‰å¾…($\text{A}\to{}\text{B}$è¡¨ç¤º$\text{A}$åœ¨ç­‰å¾…$\text{B}$é‡Šæ”¾æŸä¸ª$\text{Lock}$)
> > > >
> > > > 2. å½“$\text{Graph}$æ„æˆé—­ç¯$\to{}$â€‹æ­»é”ï¼Œä½†æ³¨æ„æˆç¯ä¸ä»£è¡¨é—­ç¯ï¼Œé—­ç¯æ˜¯è¦å½¢æˆç¯è·¯(ä¸‹å›¾ç¤ºä¾‹)
> > > >
> > > >    <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240527033215115.png" alt="image-20240527033215115" style="zoom: 33%;" /> 
> > > >
> > > > **3ï¸âƒ£**æ­»é”æ£€æµ‹ä¾‹é¢˜$\text{1:}$ åºåˆ—$\text{1}$å¦‚ä¸‹ï¼Œ$\text{C=COMMIT}$ï¼Œå…¶æ¬¡ä¸å¿…åœ¨æ„ä¸€ä¸ª$\text{Object}$å¯ä»¥ä¸è¯»å°±å†™
> > > >
> > > > | åºåˆ—: $\textbf{TXN}$ |    $\textbf{1}$     |    $\textbf{2}$     |    $\textbf{3}$     |    $\textbf{4}$     |    $\textbf{5}$     |   $\textbf{6}$   |   $\textbf{7}$   |   $\textbf{8}$   | $\textbf{9}$ |
> > > > | :------------------: | :-----------------: | :-----------------: | :-----------------: | :-----------------: | :-----------------: | :--------------: | :--------------: | :--------------: | :----------: |
> > > > |  åºåˆ—$\text{1: T1}$  | $\small\text{R(Z)}$ |     $\text{\\}$     |     $\text{\\}$     |     $\text{\\}$     | $\small\text{W(Y)}$ | $\small\text{C}$ |   $\text{\\}$    |   $\text{\\}$    | $\text{\\}$  |
> > > > |  åºåˆ—$\text{1: T2}$  |     $\text{\\}$     | $\small\text{W(X)}$ | $\small\text{W(Y)}$ |     $\text{\\}$     |     $\text{\\}$     |   $\text{\\}$    | $\small\text{C}$ |   $\text{\\}$    | $\text{\\}$  |
> > > > |  åºåˆ—$\text{1: T3}$  |     $\text{\\}$     |     $\text{\\}$     |     $\text{\\}$     | $\small\text{W(Y)}$ |     $\text{\\}$     |   $\text{\\}$    |   $\text{\\}$    | $\small\text{C}$ | $\text{\\}$  |
> > > >
> > > > 1. $\text{Lock}$è¯·æ±‚æ—¶åºï¼š$\text{T}_{1,2,3}$å¯¹$\text{X-Lock(Y)}$çš„è¯·æ±‚æ„æˆç­‰å¾… 
> > > >
> > > >    |                        $\textbf{T1}$                         |                    $\textbf{T2}$                    |                        $\textbf{T3}$                         |
> > > >    | :----------------------------------------------------------: | :-------------------------------------------------: | :----------------------------------------------------------: |
> > > >    |       $\text{R(Z)}\xrightarrow{è·å¾—}\text{S-Lock(Z)}$        |                     $\text{\\}$                     |                         $\text{\\}$                          |
> > > >    |                         $\text{\\}$                          |   $\text{W(X)}\xrightarrow{è·å¾—}\text{X-Lock(X)}$   |                         $\text{\\}$                          |
> > > >    |                         $\text{\\}$                          | ==$\text{W(Y)}\xrightarrow{è·å¾—}\text{X-Lock(Y)}$== |                         $\text{\\}$                          |
> > > >    |                         $\text{\\}$                          |                     $\text{\\}$                     | ==$\text{W(Y)}\xrightarrow[\text{T}_{2}é‡Šæ”¾]{ç­‰å¾…}\text{X-Lock(Y)}$== |
> > > >    | ==$\text{W(Y)}\xrightarrow[\text{T}_{2,3}é‡Šæ”¾]{ç­‰å¾…}\text{X-Lock(Y)}$== |                     $\text{\\}$                     |                         $\text{\\}$                          |
> > > >
> > > > 2. å¯¹äº$\text{T}_{1,2,3}$çš„$\text{Wait-For Graph}\xrightarrow{ä¸é—­ç¯}$â€‹ä¸æ„æˆæ­»é”
> > > >
> > > >    <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240527033243392.png" alt="image-20240527033243392" style="zoom:35%;" />  
> > > >
> > > > 3. $\text{TXN}$é¡ºåºï¼š$\text{T2}$å®Œæˆ$\xrightarrow[\text{T3}è·å¾—\text{X-Lock(Y)}]{\text{T}_2\text{ COMMIT}é‡Šæ”¾\text{X-Lock(Y)}}\text{T3}$å®Œæˆ$\xrightarrow[\text{T1}è·å¾—\text{X-Lock(Y)}]{\text{T}_3\text{ COMMIT}é‡Šæ”¾\text{X-Lock(Y)}}\text{T1}$å®Œæˆ
> > > >
> > > > **4ï¸âƒ£**æ­»é”æ£€æµ‹ä¾‹é¢˜$\text{2}$ 
> > > >
> > > >
> > > > | åºåˆ—: $\textbf{TXN}$ |    $\textbf{1}$     |    $\textbf{2}$     |    $\textbf{3}$     |    $\textbf{4}$     |    $\textbf{5}$     |    $\textbf{6}$     |   $\textbf{7}$   |   $\textbf{8}$   |   $\textbf{9}$   |
> > > > | :------------------: | :-----------------: | :-----------------: | :-----------------: | :-----------------: | :-----------------: | :-----------------: | :--------------: | :--------------: | :--------------: |
> > > > |  åºåˆ—$\text{2: T1}$  |     $\text{\\}$     | $\small\text{W(Y)}$ |     $\text{\\}$     |     $\text{\\}$     |     $\text{\\}$     | $\small\text{W(X)}$ | $\small\text{C}$ |   $\text{\\}$    |   $\text{\\}$    |
> > > > |  åºåˆ—$\text{2: T2}$  | $\small\text{W(X)}$ |     $\text{\\}$     |     $\text{\\}$     |     $\text{\\}$     | $\small\text{W(Y)}$ |     $\text{\\}$     |   $\text{\\}$    | $\small\text{C}$ |   $\text{\\}$    |
> > > > |  åºåˆ—$\text{2: T3}$  |     $\text{\\}$     |     $\text{\\}$     | $\small\text{R(Z)}$ | $\small\text{W(Z)}$ |     $\text{\\}$     |     $\text{\\}$     |   $\text{\\}$    |   $\text{\\}$    | $\small\text{C}$ |
> > > >
> > > > 1. $\text{Lock}$è¯·æ±‚æ—¶åºï¼š$\text{T}_{1,2,3}$å¯¹$\text{X-Lock(Y)}$â€‹çš„
> > > >
> > > >    |                        $\textbf{T1}$                         |                        $\textbf{T2}$                         |                  $\textbf{T3}$                  |
> > > >    | :----------------------------------------------------------: | :----------------------------------------------------------: | :---------------------------------------------: |
> > > >    |                         $\text{\\}$                          | <span style="color:#FF3300;">$\text{W(X)}\xrightarrow{è·å¾—}\text{X-Lock(X)}$</span> |                   $\text{\\}$                   |
> > > >    |     ==$\text{W(Y)}\xrightarrow{è·å¾—}\text{X-Lock(Y)}$==      |                         $\text{\\}$                          |                   $\text{\\}$                   |
> > > >    |                         $\text{\\}$                          |                         $\text{\\}$                          | $\text{R(Z)}\xrightarrow{è·å¾—}\text{S-Lock(Z)}$ |
> > > >    |                         $\text{\\}$                          |                         $\text{\\}$                          | $\text{W(Z)}\xrightarrow{è·å¾—}\text{X-Lock(Z)}$ |
> > > >    |                         $\text{\\}$                          | ==$\text{W(Y)}\xrightarrow[\text{T}_{1}é‡Šæ”¾]{ç­‰å¾…}\text{X-Lock(Y)}$== |                   $\text{\\}$                   |
> > > >    | <span style="color:#FF3300;">$\text{W(X)}\xrightarrow[\text{T}_{2}é‡Šæ”¾]{ç­‰å¾…}\text{X-Lock(X)}$</span> |                         $\text{\\}$                          |                   $\text{\\}$                   |
> > > >
> > > > 2. å¯¹äº$\text{T}_{1,2,3}$çš„$\text{Wait-For Graph}\xrightarrow{é—­ç¯}$â€‹æ„æˆäº†æ­»é”
> > > >
> > > >    <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240527035828981.png" alt="image-20240527035828981" style="zoom:35%;" />  
> > > >
> > > > 3. $\text{TXN}$é¡ºåºï¼šåªæœ‰$\text{T}_3$â€‹å¯ä»¥å®Œæˆ
> > > >
> > > > **5ï¸âƒ£**ä¸€äº›è¯¾å¤–è¡¥å……
> > > >
> > > > 1. æ­»é”çš„è§£å†³ï¼šé€‰æ‹©ä¸€ä¸ªæ­»é”çš„$\text{TXN}$å»(éƒ¨åˆ†)å›é€€ï¼Œè‡³äºæ˜¯å“ªä¸ªå¯ä»¥æ ¹æ®$\text{Age}$/è´Ÿè½½ç­‰
> > > > 2. æ­»é”çš„é¢„é˜²ï¼š$\text{Wait-die and Wound-die Policy}$â€‹ 
> > >
> > > #### $\textbf{2.3.2.3. Concurrency Control Method}$ 
> > >
> > > > **1ï¸âƒ£**$\text{TXN}$åºåˆ—ï¼šæ˜¯ä¸€ä¸ª$\text{Loss Update Problem}$é—®é¢˜
> > > >
> > > > | $\textbf{Time}$ | $\textbf{t=0}$ | $\textbf{t=1}$ | $\textbf{t=2}$ | $\textbf{t=3}$ | $\textbf{Final}$ |
> > > > | :-------------: | :------------: | :------------: | :------------: | :------------: | :--------------: |
> > > > |   $\text{T1}$   | $\text{R(A)}$  |  $\text{\\}$   |  $\text{\\}$   | $\text{W(A)}$  | $\text{COMMIT}$  |
> > > > |   $\text{T2}$   |  $\text{\\}$   | $\text{R(A)}$  | $\text{W(A)}$  |  $\text{\\}$   | $\text{COMMIT}$  |
> > > >
> > > > **2ï¸âƒ£**ç”¨$\text{Binary Lock}$â€‹â€‹â€‹â€‹â€‹è§£å†³
> > > >
> > > > 1. è§„åˆ™ï¼š
> > > >
> > > >    |         æ“ä½œ          | å·²å ç”¨$\textbf{Lock}$ |
> > > >    | :-------------------: | :-------------------: |
> > > >    | ç”³è¯·æ–°çš„$\text{Lock}$ |           âŒ           |
> > > >
> > > > 2. æ‰§è¡Œ
> > > >
> > > >    |                é˜¶æ®µ                |                æ“ä½œ                 |
> > > >    | :--------------------------------: | :---------------------------------: |
> > > >    |          $\text{T1-R(A)}$          |     è·å–$\text{Lock(A)}$å¹¶æ‰§è¡Œ      |
> > > >    | $\text{T2-R(A)}$å’Œ$\text{T2-W(A)}$ | ç­‰å¾…$\text{T1}$é‡Šæ”¾$\text{Lock(A)}$ |
> > > >    |          $\text{T1-W(A)}$          |     å·²æœ‰$\text{Lock(A)}$å¹¶æ‰§è¡Œ      |
> > > >    |          $\text{COMMIT}$           |      åªæœ‰$\text{W(A)}$å®Œæˆæ‰§è¡Œ      |
> > > >
> > > > **3ï¸âƒ£**$\text{Shared and Exclusive Locks(Read and Write Locks)}$â€‹â€‹è§£å†³
> > > >
> > > > 1. è§„åˆ™
> > > >
> > > >    |          æ“ä½œ           | å·²å ç”¨$\textbf{S-Lock}$ | å·²å ç”¨$\textbf{X-Lock}$ |
> > > >    | :---------------------: | :---------------------: | :---------------------: |
> > > >    | ç”³è¯·æ–°çš„$\text{S-Lock}$ |            âœ”ï¸            |            âŒ            |
> > > >    | ç”³è¯·æ–°çš„$\text{X-Lock}$ |            âŒ            |            âŒ            |
> > > >
> > > > 2. æ‰§è¡Œ
> > > >
> > > >    |       é˜¶æ®µ       | æ“ä½œ                                                         |
> > > >    | :--------------: | :----------------------------------------------------------- |
> > > >    | $\text{T1-R(A)}$ | è·å–$\text{S-Lock(A)-1}$                                     |
> > > >    | $\text{T2-R(A)}$ | è·å–$\text{S-Lock(A)-2}$ (åœ¨å·²æœ‰$\text{S-Lock}$æƒ…å†µä¸‹åœ¨è·å–ä¸€ä¸ª$\text{S-Lock}$æ˜¯$\text{OK}$çš„) |
> > > >    | $\text{T2-W(A)}$ | ç­‰å¾…$\text{T1}$é‡Šæ”¾$\text{X-Lock(A)-1}$                      |
> > > >    | $\text{T1-W(A)}$ | ç­‰å¾…$\text{T2}$é‡Šæ”¾$\text{X-Lock(A)-2}$                      |
> > > >    | $\text{COMMIT}$  | <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240527045640074.png" alt="image-20240527045640074" style="zoom: 25%;" />$\implies$æ­»é”ï¼Œè°éƒ½$\text{COMMIT}$ä¸äº† |
>
> ## $\textbf{2.4. Transaction Log}$â€‹ 
>
> > **1ï¸âƒ£**å«ä¹‰ï¼šè®°å½•æ•°æ®åº“äº‹åŠ¡å˜åŒ–çš„æ—¥å¿—ï¼ŒåŒ…æ‹¬
> >
> > 1. $\text{Transaction}$å¼€å§‹çš„è®°å½•
> > 2. æ¯ä¸ª$\text{SQL}$è¯­å¥çš„è¯¦ç»†ä¿¡æ¯
> > 3. $\text{Transaction COMMIT}$çš„è®°å½•
> >
> > **2ï¸âƒ£**ä½œç”¨ï¼šå°†æ‰€æœ‰æ›´æ”¹æ¢å¤åˆ°æœ€åä¸€æ¬¡$\text{COMMIT}$çš„çŠ¶æ€