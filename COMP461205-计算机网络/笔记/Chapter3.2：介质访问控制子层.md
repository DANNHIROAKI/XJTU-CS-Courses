# Chapter 3+：介质访问控制子层

# 1. 三种链路

> :one:点对点：单个发送端+单个接收端+二者间的链路，有PPP/HDLC协议
>
> :two:广播链路：多个发送端+多个接收端+单一共享的广播信道，一个发送端→所有接收端，如无线局域网
>
> :three:交换式链路：通过交换设备连接多个网络节点，旨在解决碰撞，如以太网

# 2. 介质访问控制协议

> ## 2.1. 信道划分协议
>
> > :zero:多路复用：多个信号在一条物理信道上传输
> >
> > :one:时分多路复用FDMA：信道划分为不同频段，每个信道带宽不同(但总和有限)，相邻信道有保护频带
> >
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240101113623549.png" alt="image-20240101113623549" style="zoom: 40%;" /> 
> >
> > :two:时分多路复用TDMA：
> >
> > 1. 类似于操作系统中的分时操作系统，但是注意有间隙
> > 2. 异步改良：如果轮到A用信道，A不用，则直接跳过A(不干等了)
> >
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240101114106937.png" alt="image-20240101114106937" style="zoom:50%;" /> 
> >
> > :three:码分多路复用CDMAL：不考https://blog.csdn.net/YCCNUST/article/details/123589294
>
> ## 2.2. 随机接入协议：用户想发就发
>
> > ### 2.2.1. ALOHA协议
> >
> > > :one:纯ALOHA协议
> > >
> > > 1. 任一结点想发数据就发
> > >
> > > 2. 数据碰撞了，则直接被销毁(传输失败)
> > >
> > > 3. 传输失败后再发，直至发送成功为止
> > >
> > >    <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240101115714450.png" alt="image-20240101115714450" style="zoom: 67%;" /> 
> > >
> > > :two:时分 ALOHA：
> > >
> > > 1. 把时间切片，每片相等
> > > 2. 规定每个时间片的开始，才能发数据
> >
> > ### 2.2.2. CSMA协议：ALOHA+载波侦听信道是否空闲
> >
> > > :one:三种策略：见2.2.3.中的小结
> > >
> > > :two:缺点：还是有可能冲突，比如两个结点同时监听到空闲，然后发信然后冲突
> >
> > ### 2.2.3. CSMA/CD协议：CSMA+碰撞检测
> >
> > > :one:三个时期
> > >
> > > 1. 传输期：传送上一帧
> > > 2. 竞争期：上一帧传完了，其他帧争相强占信道，发送碰撞后就回到竞争槽去再等待随机时间
> > > 3. 空闲期：信道中无数据传送
> > >
> > > :two:伪代码
> > >
> > > ```c
> > > A：感知信道
> > >     if(信道空闲)
> > >     {
> > >         传输数据，监听信道;
> > >         if(检测到另一个传输)//发生碰撞，信道电平会升高
> > >         {
> > >             中止传输并发送堵塞信号;  
> > >             更新碰撞次数，碰撞次数+1;
> > >             //选择延时时长的方法
> > >             //第i次碰撞就从{0,1,...,2^i-1}中选一个数K
> > >             //延时K*512时间
> > >             根据指数性规避算法进行延时; 
> > >             goto A;
> > >         }else{
> > >             将帧发送完;
> > >             将碰撞次数设置为0;
> > >         }
> > >     }else{
> > >         等待正在进行的传输结束;
> > >         goto A;
> > >     }
> > > ```
> > >
> > > :three:小结
> > >
> > > | 协议       | 信道空  | 信道忙                       | 发生冲突                     |
> > >| ---------- | ------- | ---------------------------- | ---------------------------- |
> > > | ALOHA      | 发      | 发                           | 任由碰撞，损坏数据也坚持发出 |
> > > | 1-持续CSMA | 发      | 不发，继续监听               | 任由碰撞，损坏数据也坚持发出 |
> > > | 非持续CSMA | 发      | 不发，等待随机事件后重启监听 | 任由碰撞，损坏数据也坚持发出 |
> > > | p-持续CSMA | p概率发 | 不发，下一时间间隙重启监听   | 任由碰撞，损坏数据也坚持发出 |
> > > | CSMA/CD    | 发      | 不发，继续监听               | 终止发送，等随机事件后重发   |
> > 
> > ### 2.2.4. CSMA/CA协议：CSMA+冲突避免机制
> >
> > > :one:其他都一样，不同点是发完一帧要等待确认
> >>
> > > :two:发送端收到确认，则无冲突(否则重传)
> 
> ## 2.3. 轮询协议
>
> > :one:集中式轮询(左)：
>>
> > 1. 主结点循环顺序询问每个结点
> >
> > 2. 主节点告诉当前询问结点能传输帧数最大值，然后传输完数据
> >
> > 3. 转去询问下一结点
> >
> >     <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240101141733768.png" alt="image-20240101141733768" style="zoom: 67%;" />  
> >
> > :two:令牌传递轮询(右)
> >
> > 1. Token(一个特殊帧)在结点间，按照固定次序传递
> > 2. 一个结点，有令牌传过来&&有帧需要发，就接住令牌并发出帧(否则立马传给下一个)

# 3. 局域网LAN：以太网/无线局域网为主

> 以太网=802.3，无线局域网=802.11
>
> ## 3.1. 以太网的MAC帧
>
> > :one:MAC地址：物理地址/硬件地址，与网卡一一对应(刻在网卡ROM里)，长48bit(高24bit为厂家代码)
> >
> > :two:MAC帧格式：aka以太网帧
> >
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240101142836250.png" alt="image-20240101142836250" style="zoom:60%;" /> 
> >
> > | 字段        | 长度     | 描述                                          |
> > | ----------- | -------- | --------------------------------------------- |
> > | 前导码      | 8B       | 前同步码7B+帧开始定界符1B，用于收发端时钟同步 |
> > | 源/目的地址 | 6B       | 对应发/收设备的网卡==MAC地址==                |
> > | 类型        | 2B       | 指明数据交给哪个协议处理                      |
> > | 数据        | 46-1500B | 所传输的数据，不超过1500B，小于46B时强制补充  |
> > | 校验码FCS   | 4B       | 用CRC校验除前导码外的其他字段                 |
> >
> > :three:MAC帧种类
> >
> > | 帧类型 | 目的地址特征               | 描述                             |
> > | ------ | -------------------------- | -------------------------------- |
> > | 单播帧 | 前8位最后一位为0           | 发给特定工作站，由主机自己识别   |
> > | 组播帧 | 前8位最后一位为1，其余随便 | 发给特定一组工作站，由适配器识别 |
> > | 广播帧 | 前8位全为1                 | 发送给所有工作站，靠全1识别      |
> >
>
> ## 3.2. ARP协议：子网内IP$\xleftrightarrow{转化}$MAC(其实这是网络层协议)
>
> > :one:ARP表：子网内每个主机/路由器中都有，包含IP$\xleftrightarrow[动态]{转化}$MAC和TTL(删除该映射倒计时)
> >
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240101144656275.png" alt="image-20240101144656275" style="zoom:50%;" /> 
> >
> > :two:同局域网发送IP分组
> >
> > 1. 主机先查询ARP表(缓冲)→找到目标主机IP→转化为MAC地址→写入MAC帧→发出
> > 2. 如果暂时找不到IP：广播ARP请求分组→目的主机响应→ARP表中建立表项→继续
> >
> > :three:跨局域网发送IP分组：先通过ARP分组发给本局域网的路由器，路由器转发给其他网络
> >
> > 所有常见情况：
> >
> > | 发送方 | 目的地         | ARP用途                   | 描述                   |
> > | ------ | -------------- | ------------------------- | ---------------------- |
> > | 主机   | 本网络主机     | 获取目的主机MAC地址       | 在本地网络内通信       |
> > | 主机   | 另一网络主机   | 获取本网络路由器MAC地址   | 由路由器转发至其他网络 |
> > | 路由器 | 本网络的主机   | 获取目的主机MAC地址       | 在本地网络内通信       |
> > | 路由器 | 另一网络的主机 | 获取本网络上路由器MAC地址 | 由路由器转发至其他网络 |
> >
>
> ## 3.3. 以太网：最流行的有线局域网
>
> > :one:结构：通过集线器(Hub)/交换机连接各主机，连接的介质有光纤/双绞线/电缆
> >
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240101150903290.png" alt="image-20240101150903290" style="zoom: 67%;" /> 
> >
> > :two:集线器和交换机：用交换机连接的是交换式以太网
> >
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20240101153344457.png" alt="image-20240101153344457" style="zoom:67%;" /> 
> >
> > :three:服务模式：CRC+CSMA/CD，==无连接不可靠==，Manchester编码
> >
> > :four:高速以太网
> >
> > | 以太网类型     | 介质   | 最大电缆长度 | 拓扑结构 | 传输模式  | CSMA/CD 协议应用 |
> > | -------------- | ------ | ------------ | -------- | --------- | ---------------- |
> > | 100Base-T      | 双绞线 | 100米        | 星形     | 半/全双工 | 半双工时需要     |
> > | 千兆以太网     | 不指定 | 不指定       | 不指定   | 半/全双工 | 半双工时需要     |
> > | 10吉比特以太网 | 光纤   | 不适用       | 不适用   | 全双工    | 不使用           |
>
> ## 3.4. 无线局域网IEEE 802.11：基于CSMA/CA+确认机制
>
> > ### 3.4.1. 有固定基础设施
> >
> > > :one:最小构件：
> > >
> > > 1. 基本服务集(BSS)：就是一个基站(aka接入点AP)+若干移动站
> > > 2. 本BSS内可直接通讯，之外要通过基站
> > >
> > > :two:扩展服务集(ESS)：多个BSS通过主干分配系统(DS)相连，构成的集合
> > >
> > > :three:门桥设备：使无线网用户接入非802.11无线局域网
> >
> > ### 3.4.2. 无固定基础设施
> >
> > > 由一些平等的，可路由的移动站之间相互通信组成的临时网络
> >
> > ### 3.4.3. IEEE 802.11的层
> >
> > > :one:物理层：跳频扩频(FHSS)，直接序列扩频(DSS)，红外线(IR)
> > >
> > > :two:MAC层：在物理层之上，包含分布协调功能子层(DCF)，点协调功能子层(PCF)
>
> ## 3.5. 其他
>
> > :one:虚拟局域网VLAN：一组逻辑上的设备和用户，不受地理限制，相互之间的通信好像在同一网段一样
> >
> > :two:广域网：交换机连接多个局域网

# 4. 网桥

> ## 4.1. 网桥的概述
>
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/PicGo-Typora-GitHub-Picture-bed/main/img/image-20231005191943383.png" alt="image-20231005191943383" style="zoom: 67%;" />  
> >
> > :one:结构功能：工作在数据链路层，能过滤帧，至少两个端口(每端口接一个网段)
> >
> > :two:工作流程：端口收到帧后缓存，帧转发给同一网段就丢弃，给不同网段就查表转发
> >
> > :three:特点：过滤通信量/扩大物理范围/互联各种以太网，增加延时/无流量控制
> >
>
> ## 4.2. 透明网桥
>
> > :one:特点：发出的帧结果哪个网桥是随机的
> >
> > :two:自学习
> >
> > 1. 网桥收到一帧后，帧源地址$\xleftrightarrow{匹配}$转发表中与收到帧的源地址
> > 2. 匹配失败：在转发表中增加一个项目(源地址+进入的接口+时间)
> > 3. 匹配成功：更新原有信息
> >
> > :three:帧转发
> >
> > 1. 帧目的地址$\xleftrightarrow{匹配}$转发表中与收到帧的目的地址
> > 2. 匹配成功就按表项转发，失败就转给所有接口
> >
> > :four:爱的网桥转圈圈：解决办法时生成树
> >
> > <img src="https://raw.githubusercontent.com/DANNHIROAKI/PicGo-Typora-GitHub-Picture-bed/main/img/image-20231005195715685.png" alt="image-20231005195715685" style="zoom: 67%;" /> 
>
> ## 4.3. 源选径网桥
>
> > :one:源站$\xrightarrow[帧沿所有可能路线传递]{广播一个帧}\xrightarrow{记录所经路由}$目的站
> >
> > :two:源站根据记录得到的最佳路由选择一个路由，燃油有请网桥
> >
>
> ## 4.4. 局域网交换机及其工作原理
>
> > :one:局域网交换机：aka==多端口网桥==，处在链路层，每个端口连接主机/集线器，全双工工作
> >
> > :two:交换机总容量：端口数×每个端口带宽(半双工)，端口数×每个端口带宽×2(全双工)
> >
> > :three:交换机的工作模式
> >
> > 1. 直通式：只检查帧的目的地址，收到后立马转出
> >
> > 2. 存储转发：缓存收到帧，检查无误后(有误直接丢掉)，根据查表从端口送出
> >
> >
> > :four:局域网交换机的工作原理
> >
> > 1. 检测从某端口进入交换机的帧的源 MAC 地址和目的 MAC 地址
> > 2. 若数据报的 MAC 地址不在查找表中，则将该地址加入查找表中，并将数据报发送给相应目的端口







